#!/bin/bash

echo "System76 Software Setup for openSUSE"
echo "------------------------------------"
echo "Official System76 repositories for openSUSE are not commonly available."
echo "You may need to find unofficial packages via the Open Build Service (OBS)"
echo "or compile components from source. This script will only install 'pesign'."
echo "Proceed with caution and verify package sources."
echo ""

# Update sources
echo "Refreshing repositories..."
sudo zypper refresh

# Placeholder for System76 software installation
echo "System76 specific packages (system76-firmware, system76-power, system76-dkms)"
echo "would need to be sourced from OBS or built manually for openSUSE."
echo "# Example (if packages were available):"
echo "# sudo zypper install -y system76-firmware-daemon system76-power system76-dkms"
echo ""

# Install NVIDIA drivers (openSUSE way)
echo "For NVIDIA graphics on openSUSE, use the official NVIDIA repositories or community repos:"
echo "1. Add NVIDIA repository: https://en.opensuse.org/SDB:NVIDIA_drivers"
echo "2. Install drivers: sudo zypper install nvidia-glG0X (X depends on your card series)"
echo ""

# Install pesign
echo "Installing pesign..."
sudo zypper install --non-interactive -y pesign

# --- MOK Utility (Manual Steps Required) ---
echo ""
echo "---------------------------------------------------------------------------"
echo "IMPORTANT: Secure Boot & Kernel Signing (MOK Utility)"
echo "The following commands are for signing your kernel if you use Secure Boot."
echo "These are ADVANCED steps and require MANUAL ADAPTATION."
echo ""
echo "1. Identify the exact kernel image path you need to sign."
echo "   Example: /boot/vmlinuz-$(uname -r)"
echo "2. Replace '/boot/vmlinuz-YOUR-KERNEL-VERSION' with your actual kernel path."
echo "3. The hash 'YOUR_KERNEL_HASH_HERE' will be output by the 'pesign' command."
echo "   You MUST use the hash specific to YOUR kernel."
echo ""
echo "# Example commands (DO NOT RUN AS IS - ADAPT THEM):"
echo "# sudo pesign -s -i /boot/vmlinuz-YOUR-KERNEL-VERSION -o /boot/vmlinuz-YOUR-KERNEL-VERSION.signed -c YOUR_CERT_NICKNAME"
echo "# sudo mokutil --import /path/to/your/signing_key.der  (if key not enrolled)"
echo "# sudo mokutil --import-hash YOUR_KERNEL_HASH_HERE (if using hash)"
echo "---------------------------------------------------------------------------"

echo "System76 software installation script (limited for openSUSE) finished."
